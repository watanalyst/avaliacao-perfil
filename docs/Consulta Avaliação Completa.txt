SELECT
    A.ID,
    A.NUMCAD,
    A.NOMFUN,
    A.DATA_AVALIACAO,
    A.STATUS,
    A.OBSERVACAO,

    A.FINALIZADO_EM,
    A.FINALIZADO_POR,
    A.REABERTO_EM,
    A.REABERTO_POR,
    A.MOTIVO_REABERTURA,

    /* IFP */
    I.ASSISTENCIA,
    I.INTRACEPCAO,
    I.AFAGO,
    I.AUTONOMIA,
    I.DEFERENCIA,
    I.AFILIACAO,
    I.DOMINANCIA,
    I.DESEMPENHO,
    I.EXIBICAO,
    I.AGRESSAO,
    I.ORDEM,
    I.PERSISTENCIA,
    I.MUDANCA,

    /* PROFILER - 4 decimais */
    P.EXECUTOR,
    P.PLANEJADOR,
    P.ANALISTA,
    P.COMUNICADOR,

    /* PROFILER - descrições (via domínio) */
    N_ENE.DESCRICAO AS ENERGIA,
    N_EXM.DESCRICAO AS EXIGENCIA_MEIO,
    N_APR.DESCRICAO AS APROVEITAMENTO,
    N_MOR.DESCRICAO AS MORAL,
    N_POS.DESCRICAO AS POSITIVIDADE,
    N_FLX.DESCRICAO AS FLEXIBILIDADE,
    N_AMP.DESCRICAO AS AMPLITUDE,
    N_AUT.DESCRICAO AS AUTOMOTIVACAO,
    N_INC.DESCRICAO AS INCITABILIDADE,

    /* Âncoras pivotadas por ORDEM do domínio */
    ANC.ANC_01_COMP_TEC_FUNC,
    ANC.ANC_02_COMP_GER_GERAL,
    ANC.ANC_03_AUTON_IND,
    ANC.ANC_04_SEG_ESTAB,
    ANC.ANC_05_CRIAT_EMPREEN,
    ANC.ANC_06_SERV_DED_CAUSA,
    ANC.ANC_07_PURO_DESAFIO,
    ANC.ANC_08_ESTILO_VIDA

FROM LOGIXPRD.RH_AVALIACAO_PERFIL A

    LEFT JOIN LOGIXPRD.RH_IFP_RESULTADO I
        ON I.AVALIACAO_ID = A.ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_RESULTADO P
        ON P.AVALIACAO_ID = A.ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_ENE
        ON N_ENE.ID = P.ENERGIA_NIVEL_ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_EXM
        ON N_EXM.ID = P.EXIGENCIA_MEIO_NIVEL_ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_APR
        ON N_APR.ID = P.APROVEITAMENTO_NIVEL_ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_MOR
        ON N_MOR.ID = P.MORAL_NIVEL_ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_POS
        ON N_POS.ID = P.POSITIVIDADE_NIVEL_ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_FLX
        ON N_FLX.ID = P.FLEXIBILIDADE_NIVEL_ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_AMP
        ON N_AMP.ID = P.AMPLITUDE_NIVEL_ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_AUT
        ON N_AUT.ID = P.AUTOMOTIVACAO_NIVEL_ID

    LEFT JOIN LOGIXPRD.RH_PROFILER_NIVEL N_INC
        ON N_INC.ID = P.INCITABILIDADE_NIVEL_ID

    LEFT JOIN (
        SELECT
            AR.AVALIACAO_ID,

            MAX(CASE WHEN AT.ORDEM = 1 THEN AR.VALOR END) AS ANC_01_COMP_TEC_FUNC,
            MAX(CASE WHEN AT.ORDEM = 2 THEN AR.VALOR END) AS ANC_02_COMP_GER_GERAL,
            MAX(CASE WHEN AT.ORDEM = 3 THEN AR.VALOR END) AS ANC_03_AUTON_IND,
            MAX(CASE WHEN AT.ORDEM = 4 THEN AR.VALOR END) AS ANC_04_SEG_ESTAB,
            MAX(CASE WHEN AT.ORDEM = 5 THEN AR.VALOR END) AS ANC_05_CRIAT_EMPREEN,
            MAX(CASE WHEN AT.ORDEM = 6 THEN AR.VALOR END) AS ANC_06_SERV_DED_CAUSA,
            MAX(CASE WHEN AT.ORDEM = 7 THEN AR.VALOR END) AS ANC_07_PURO_DESAFIO,
            MAX(CASE WHEN AT.ORDEM = 8 THEN AR.VALOR END) AS ANC_08_ESTILO_VIDA

        FROM LOGIXPRD.RH_ANCORA_RESULTADO AR

            INNER JOIN LOGIXPRD.RH_ANCORA_TIPO AT
                ON AT.ID = AR.ANCORA_TIPO_ID

        GROUP BY
            AR.AVALIACAO_ID
    ) ANC
        ON ANC.AVALIACAO_ID = A.ID

/*    LEFT JOIN VETORH.R034FUN R
        ON R.NUMCAD = A.NUMCAD   -- (se quiser puxar o nome "ao vivo" do Senior) */

WHERE 1=1
    AND A.ID = :P_ID
;
